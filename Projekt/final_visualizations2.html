<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Európai Gazdasági és Környezeti Mutatók</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
    <script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 10px;
            color: #333;
            background: linear-gradient(
                45deg,
                #FF6B6B,
                #4ECDC4,
                #6C5CE7,
                #a8e6cf,
                #FF8C94
            );
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
        }

        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        header {
            text-align: center;
            padding: 40px 0;
            border-bottom: 2px solid #eee;
            margin-bottom: 40px;
        }

        h1 {
            font-size: 2em;
            margin: 0;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        .subtitle {
            font-size: 1em;
            color: white;
            margin: 10px 0 30px 0;
        }

        .intro {
            max-width: 800px;
            margin: 20px auto;
            line-height: 1.6;
            font-size: 1.1em;
            color: #555;
            background: rgba(255, 255, 255, 0.7);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            width: 90%;
        }

        /* Speciális margó csak a gyermekhalálozási ábra dobozának */
        .chart-container:nth-child(3) .intro {
            margin: 120px auto 10px auto;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.5);
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(5px);
            margin: 20px auto;
            padding: 25px;
            transition: transform 0.2s ease;
            min-height: 500px;
            width: 95%;
            max-width: 1100px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .chart-container:last-child {
            grid-column: auto;
        }

        .chart-container:hover {
            transform: translateY(-5px);
        }

        .chart-title, .chart-description {
            width: 100%;
            text-align: center;
        }

        .chart-title {
            font-size: 1.4em;
            color: #333;
            margin: 0 0 15px 0;
            text-align: center;
            width: 100%;
        }

        .chart-description {
            font-size: 1.1em;
            color: #444;
            margin-bottom: 20px;
            line-height: 1.6;
            text-align: center;
            width: 90%;
            max-width: 800px;
        }

        footer {
            text-align: center;
            padding: 40px 0;
            color: white;
            border-top: 2px solid #eee;
            margin-top: 40px;
        }

        #gdp-vis, #heatmap, #violin-plot-child, #line-chart-air, #map, #chart {
            width: 100%;
            height: 500px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 15px;
            box-sizing: border-box;
            margin: 0 auto;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #heatmap {
            height: 650px;  /* Növeljük a heatmap magasságát */
            margin-top: 40px;
            margin-bottom: 40px;
        }

        #heatmap svg {
            width: 100%;
            height: 100%;
            display: block;
            margin: 0 auto;
        }

        .tooltip {
            position: absolute;
            padding: 8px;
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid #ddd;
            border-radius: 4px;
            pointer-events: none;
            font-size: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            color: #333;
        }

        .controls {
            margin: 20px auto;
            display: flex;
            justify-content: center;
            gap: 20px;
            width: 100%;
            margin-bottom: 40px;
        }

        select {
            padding: 8px 16px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: white;
            font-size: 14px;
            min-width: 150px;
        }

        svg {
            display: block;
            margin: 0 auto;
        }

        .bar {
            fill: steelblue;
            transition: fill 0.2s;
        }

        .bar:hover {
            fill: #ff7f0e;
        }

        /* Speciális beállítás a CO2 kibocsátás konténerének */
        .chart-container:nth-child(2) {
            min-height: 800px;  /* Növeljük a konténer minimális magasságát */
            height: auto;
            padding-bottom: 40px;
        }

        @media (max-width: 1200px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .chart-container:last-child {
                grid-column: auto;
            }
            
            .chart-container {
                min-height: 500px;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>Európai Gazdasági és Környezeti Mutatók</h1>
        <div class="subtitle"><p>Ez a projekt egy átfogó adatvizualizációs portfólió, amely Európa keleti és nyugati országainak gazdasági, társadalmi és környezeti mutatóit vizsgálja 1990 és 2017 között. Az adatforrások megbízható nemzetközi adatbázisokból származnak, például a Világbank vagy az OECD nyilvános statisztikáiból.</p>
            <p>A portfólió 6 adatvizualizációból áll, például vonaldiagramokból, violin plotokból, hőtérképekből és térképes ábrázolásokból. Ezek az ábrák az egy főre jutó GDP, gyermekhalálozási arány, CO2 kibocsátás, PM2.5 légszennyezés és az infláció változását mutatják be országonként.</p>
            <p>Az adatok azért érdekesek, mert világosan feltárják a kelet- és nyugat-európai országok közötti különbségeket, fejlődési trendeket, valamint a környezetvédelem és az életszínvonal javulásának jeleit.</p>
            <p>A célfelhasználók elsősorban gazdasági és társadalmi elemzők, egyetemi hallgatók, oktatók és döntéshozók, akik átfogó képet szeretnének kapni Európa fejlődéséről az elmúlt évtizedek során.</p>
            <p>A projekt célja, hogy a felhasználók felismerjék a régiós különbségeket, a fejlődési irányokat, és jobban megértsék a gazdasági és környezeti összefüggéseket.</p>
        </div>
    </header>

    <div class="charts-grid">
        <div class="chart-container">
            <h2 class="chart-title">GDP per Capita alakulása 1990 és 2017 között</h2>
            <div class="chart-description">Az európai országok gazdasági fejlődésének összehasonlító elemzése az egy főre jutó GDP alapján.</div>
            <div id="gdp-vis"></div>
            <div class="intro">
                <p>A GDP per capita mutató jól szemlélteti az országok gazdasági fejlettségének különbségeit. Az ábrán látható, hogy a nyugat-európai országok (Svájc, Norvégia, Svédország, Ausztria, Franciaország) jelentősen magasabb GDP értékekkel rendelkeznek, mint a kelet-európai országok (Lengyelország, Magyarország, Románia, Bulgária).</p>
            </div>
        </div>

        <div class="chart-container">
            <h2 class="chart-title">CO2 Kibocsátás - Kelet és Nyugat Európa</h2>
            <div class="chart-description">A szén-dioxid kibocsátás változásának vizsgálata Európa két régiójában.</div>
            <div id="heatmap"></div>
            <div class="intro">
                <p>A CO2 kibocsátás hőtérképe megmutatja, hogy az egyes országok hogyan teljesítettek a környezetvédelem terén. A sötétebb színek magasabb kibocsátást jeleznek. Megfigyelhető, hogy a nyugat-európai országok általában alacsonyabb kibocsátási értékekkel rendelkeznek, és folyamatos csökkenő tendenciát mutatnak.</p>
            </div>
        </div>

        <div class="chart-container">
            <h2 class="chart-title">Gyermekhalálozási Arány alakulása Nyugat és Kelet Európában</h2>
            <div class="chart-description">A gyermekhalálozási ráta összehasonlító elemzése az európai régiók között.</div>
            <div id="violin-plot-child"></div>
            <div class="intro">
                <p>A gyermekhalálozási arány violin plot ábrája jól mutatja a régiók közötti különbségeket. A nyugat-európai országokban általában alacsonyabb értékeket láthatunk, míg a kelet-európai országokban magasabb, de csökkenő tendenciát mutató értékek figyelhetők meg az 1990-2017 közötti időszakban.</p>
            </div>
        </div>

        <div class="chart-container">
            <h2 class="chart-title">Légszennyezés alakulása Nyugat és Kelet Európában</h2>
            <div class="chart-description">A légszennyezettségi mutatók változásának vizsgálata az európai országokban.</div>
            <div id="line-chart-air"></div>
            <div class="intro">
                <p>A légszennyezettségi adatok vonaldiagramja szemlélteti a PM2.5 részecskék koncentrációjának változását. Az ábra jól mutatja, hogy a kelet-európai országokban általában magasabb a légszennyezettség szintje, bár az évek során mindkét régióban javuló tendencia figyelhető meg.</p>
            </div>
        </div>

        <div class="chart-container">
            <h2 class="chart-title">Várható Élettartam Európai Összehasonlításban</h2>
            <div class="chart-description">A várható élettartam alakulása az európai országokban, különös tekintettel a kelet-nyugati különbségekre.</div>
            
            <div id="lifeexp-title-dropdowns" style="width:100%;text-align:center;">
                <div id="lifeexp-title" style="font-size: 20px; font-weight: bold; margin-bottom: 10px; text-align: center;"></div>
                <div class="controls" style="justify-content: center;">
                    <select id="yearSelect"></select>
                    <select id="countryCount">
                        <option value="selected">Selected Countries</option>
                        <option value="10">Top 10 Countries</option>
                        <option value="20">Top 20 Countries</option>
                        <option value="50">Top 50 Countries</option>
                    </select>
                </div>
            </div>
            <div id="chart"></div>
            
            <div class="intro">
                <p>A várható élettartam az egyik legfontosabb mutatója egy ország egészségügyi és társadalmi fejlettségének. Az ábra jól szemlélteti a nyugat- és kelet-európai országok közötti különbségeket, valamint az elmúlt évtizedekben bekövetkezett változásokat.</p>
            </div>
        </div>

        <div class="chart-container">
            <h2 class="chart-title">Térképes Inflációs Adatvizualizáció Nyugat és Kelet Európában</h2>
            <div class="chart-description">Az átlagos inflációs ráták földrajzi eloszlásának interaktív térképes megjelenítése.</div>
            <div id="map"></div>
            <div class="intro">
                <p>Az interaktív térkép az inflációs ráták földrajzi eloszlását mutatja be. A körök mérete és színe az infláció mértékét jelzi: a sötétebb és nagyobb körök magasabb inflációs rátát jelentenek. A térképen jól látható a kelet-nyugati különbség az inflációs ráták tekintetében.</p>
            </div>
        </div>
    </div>

    <footer>
        <p>Adatok forrása: Nemzetközi gazdasági és környezeti adatbázisok</p>
        <p>© 2024 Európai Gazdasági és Környezeti Elemzés</p>
    </footer>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
        // GDP Visualization
        fetch('https://raw.githubusercontent.com/FHuni/FHuni.github.io/refs/heads/main/Projekt/GDP_final.json')
            .then(response => response.json())
            .then(data => {
                const processedData = data.map(d => ({
                    Country: d.Country,
                    Year: new Date(d['String Date']).getFullYear(),
                    GDP: d.Price
                }));

                const selectedCountries = ["France", "Switzerland", "Sweden", "Austria", "Norway", "Poland", "Hungary", "Romania", "Bulgaria"];
                const filteredData = processedData.filter(d => 
                    selectedCountries.includes(d.Country) && d.Year >= 1990 && d.Year <= 2017
                );

                const spec = {
                    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
                    "width": "container",
                    "height": "container",
                    "autosize": {
                        "type": "fit",
                        "contains": "padding",
                        "resize": true
                    },
                    "data": { "values": filteredData },
                    "mark": {
                        "type": "line",
                        "interpolate": "monotone",
                        "strokeWidth": 3.5,
                        "point": {
                            "filled": true,
                            "size": 50
                        }
                    },
                    "encoding": {
                        "x": {
                            "field": "Year",
                            "type": "quantitative",
                            "title": "Év",
                            "scale": {"domain": [1990, 2017]},
                            "axis": {
                                "values": [1990, 1993, 1996, 1999, 2002, 2005, 2008, 2011, 2014, 2017],
                                "labelAngle": 0,
                                "format": "d",
                                "labelFontSize": 16,
                                "titleFontSize": 18
                            }
                        },
                        "y": {
                            "field": "GDP",
                            "type": "quantitative",
                            "title": "GDP per Capita (USD)",
                            "axis": {
                                "format": "~s",
                                "labelFontSize": 16,
                                "titleFontSize": 18,
                                "domain": [15000, 130000],
                                "tickCount": 13
                            }
                        },
                        "color": {
                            "field": "Country",
                            "type": "nominal",
                            "legend": {
                                "title": "Országok",
                                "orient": "right",
                                "titleFontSize": 18,
                                "labelFontSize": 16,
                                "symbolSize": 200,
                                "titlePadding": 20,
                                "labelPadding": 10,
                                "symbolType": "circle",
                                "fillColor": "white",
                                "strokeColor": "lightgray",
                                "cornerRadius": 10,
                                "padding": 15,
                                "offset": 10
                            },
                            "sort": {
                                "field": "GDP",
                                "op": "mean",
                                "order": "descending"
                            }
                        },
                        "tooltip": [
                            {"field": "Country", "type": "nominal", "title": "Ország"},
                            {"field": "Year", "type": "quantitative", "title": "Év"},
                            {"field": "GDP", "type": "quantitative", "title": "GDP", "format": ",.2f"}
                        ],
                        "opacity": {
                            "value": 1
                        }
                    },
                    "config": {
                        "background": "transparent",
                        "view": {"stroke": "transparent"},
                        "axis": {
                            "labelColor": "black",
                            "titleColor": "black",
                            "gridColor": "rgba(0, 0, 0, 0.1)",
                            "domainColor": "black"
                        },
                        "legend": {
                            "labelColor": "black",
                            "titleColor": "black",
                            "strokeColor": "#ccc",
                            "fillColor": "rgba(255, 255, 255, 0.8)",
                            "cornerRadius": 10,
                            "padding": 15
                        }
                    }
                };

                vegaEmbed("#gdp-vis", spec, {
                    actions: false,
                    renderer: "canvas"
                });
            });

        // CO2 Visualization
        fetch('https://raw.githubusercontent.com/FHuni/FHuni.github.io/refs/heads/main/Projekt/CO2_Emissions_final.json')
            .then(response => response.json())
            .then(data => {
                const tooltip = d3.select("body").append("div")
                    .attr("class", "tooltip")
                    .style("opacity", 0);

                const allPossibleYears = [...new Set(data.map(d => d['String Date'].substring(0,4)))];
                const totalYears = allPossibleYears.length;

                const westernEurope = ["France", "Switzerland", "Sweden", "Austria", "Norway"];
                const easternEurope = ["Poland", "Hungary", "Romania", "Bulgaria"];

                const countryCompleteness = {};
                const countryAverages = {};

                [...new Set(data.map(d => d.Country))].forEach(country => {
                    const countryData = data.filter(d => d.Country === country);
                    const yearsWithData = new Set(countryData.map(d => d['String Date'].substring(0,4)));
                    countryCompleteness[country] = yearsWithData.size / totalYears;
                    countryAverages[country] = d3.mean(countryData, d => d.Price);
                });

                const validEasternEurope = easternEurope
                    .filter(country => countryCompleteness[country] >= 0.95)
                    .sort((a, b) => countryAverages[b] - countryAverages[a])
                    .slice(0, 6);

                const westCountries = westernEurope
                    .filter(country => data.some(d => d.Country === country))
                    .sort((a, b) => countryAverages[a] - countryAverages[b])
                    .slice(0, 6);

                const selectedCountries = [...westCountries, ...validEasternEurope];

                const filteredData = data.filter(d => selectedCountries.includes(d.Country));
                const allYears = [...new Set(filteredData.map(d => d['String Date'].substring(0,4)))];
                
                const startYear = parseInt(allYears[0]);
                const years = allYears.filter(year => (parseInt(year) - startYear) % 5 === 0);

                const margin = {top: 70, right: 40, bottom: 60, left: 120};  // Növeljük a felső margót
                const width = 900 - margin.left - margin.right;
                const height = 500 - margin.top - margin.bottom;

                const globalMin = d3.min(filteredData, d => d.Price);
                const globalMax = d3.max(filteredData, d => d.Price);

                const legendScale = d3.scaleSequential()
                    .interpolator(t => d3.interpolate("#deebf7", "#3182bd")(t))
                    .domain([globalMin, globalMax]);

                // Először hozzuk létre a fő SVG-t
                const mainSvg = d3.select("#heatmap")
                    .append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .style("display", "block")
                    .style("margin", "0 auto");

                // Adjuk hozzá a legendát a fő SVG tetejére
                const legend = mainSvg.append("g")
                    .attr("class", "legend")
                    .attr("transform", `translate(${margin.left + (width - 300) / 2}, 20)`);  // Középre igazítjuk

                legend.append("rect")
                    .attr("width", 300)
                    .attr("height", 15)
                    .style("fill", "url(#legend-gradient)");

                // Gradient definíció
                const defs = mainSvg.append("defs");
                const gradient = defs.append("linearGradient")
                    .attr("id", "legend-gradient")
                    .attr("x1", "0%")
                    .attr("x2", "100%")
                    .attr("y1", "0%")
                    .attr("y2", "0%");

                const stops = [0, 0.2, 0.4, 0.6, 0.8, 1];
                stops.forEach(stop => {
                    gradient.append("stop")
                        .attr("offset", `${stop * 100}%`)
                        .attr("stop-color", legendScale(globalMin + (globalMax - globalMin) * stop));
                });

                const legendAxisScale = d3.scaleLinear()
                    .domain([globalMin, globalMax])
                    .range([0, 300]);

                const legendAxis = d3.axisBottom(legendAxisScale)
                    .ticks(8)
                    .tickFormat(d => d.toFixed(1));

                legend.append("g")
                    .attr("transform", "translate(0, 15)")
                    .call(legendAxis)
                    .call(g => g.selectAll(".tick text")
                        .attr("dy", "0.7em"));

                legend.append("text")
                    .attr("x", 150)
                    .attr("y", -5)
                    .attr("text-anchor", "middle")
                    .style("font-size", "12px")
                    .text("CO2 Kibocsátás (tonna/fő)");

                // Fő vizualizáció csoportja
                const mainGroup = mainSvg.append("g")
                    .attr("transform", `translate(${margin.left},${margin.top})`);

                const xAll = d3.scaleBand()
                    .domain(allYears)
                    .range([5, width - 10])
                    .padding(0.08);

                const x = d3.scaleBand()
                    .domain(years)
                    .range([20, width - 20])
                    .padding(0.25);

                const y = d3.scaleBand()
                    .domain(selectedCountries)
                    .range([0, height])
                    .padding(0.15);

                mainGroup.append("g")
                    .attr("transform", `translate(0,${height})`)
                    .attr("class", "axis")
                    .call(d3.axisBottom(x))
                    .selectAll("text")
                    .attr("transform", "rotate(-45)")
                    .style("text-anchor", "end")
                    .attr("dx", "-0.8em")
                    .attr("dy", "0.15em");

                mainGroup.append("g")
                    .attr("class", "axis")
                    .call(d3.axisLeft(y));

                selectedCountries.forEach((country, countryIndex) => {
                    const countryData = filteredData.filter(d => d.Country === country);
                    
                    const countryMin = d3.min(countryData, d => d.Price);
                    const countryMax = d3.max(countryData, d => d.Price);
                    
                    const colorScale = d3.scaleSequential()
                        .interpolator(t => d3.interpolate("#deebf7", "#3182bd")(t))
                        .domain([countryMin, countryMax]);

                    mainGroup.selectAll()
                        .data(countryData)
                        .enter()
                        .append("rect")
                        .attr("x", d => xAll(d['String Date'].substring(0,4)))
                        .attr("y", y(country))
                        .attr("width", xAll.bandwidth())
                        .attr("height", y.bandwidth())
                        .attr("fill", d => colorScale(d.Price))
                        .attr("class", "heatmap-cell")
                        .on("mouseover", function(event, d) {
                            tooltip.transition()
                                .duration(200)
                                .style("opacity", .9);
                            tooltip.html(`Ország: ${d.Country}<br/>Év: ${d['String Date'].substring(0,4)}<br/>CO2 Kibocsátás: ${d.Price.toFixed(3)} tonna/fő`)
                                .style("left", (event.pageX + 10) + "px")
                                .style("top", (event.pageY - 28) + "px");
                        })
                        .on("mouseout", function(d) {
                            tooltip.transition()
                                .duration(500)
                                .style("opacity", 0);
                        });
                });
            });

        // Child Mortality Visualization
        fetch("https://raw.githubusercontent.com/FHuni/FHuni.github.io/refs/heads/main/Projekt/ChildMortalityRate_final.json")
            .then(response => response.json())
            .then(data => {
                const countryMap = {
                    "Switzerland": "Svájc",
                    "France": "Franciaország",
                    "Sweden": "Svédország",
                    "Austria": "Ausztria",
                    "Norway": "Norvégia",
                    "Poland": "Lengyelország",
                    "Hungary": "Magyarország",
                    "Bulgaria": "Bulgária",
                    "Romania": "Románia"
                };

                const colors = {
                    "Switzerland": 'rgba(255, 99, 132, 0.6)',
                    "France": 'rgba(54, 162, 235, 0.6)',
                    "Sweden": 'rgba(255, 206, 86, 0.6)',
                    "Austria": 'rgba(75, 192, 192, 0.6)',
                    "Norway": 'rgba(153, 102, 255, 0.6)',
                    "Poland": 'rgba(255, 159, 64, 0.6)',
                    "Hungary": 'rgba(199, 199, 199, 0.6)',
                    "Bulgaria": 'rgba(83, 102, 255, 0.6)',
                    "Romania": 'rgba(255, 99, 255, 0.6)'
                };

                const selectedCountries = Object.keys(countryMap);
                const plotData = [];

                selectedCountries.forEach(country => {
                    const countryEntries = data.filter(d => d.Country === country);

                    if (countryEntries.length > 0) {
                        const yValues = countryEntries.map(d => d.Price);
                        const hoverTexts = countryEntries.map(d =>
                            `Ország: ${countryMap[country]}<br>Év: ${new Date(d.Date).getFullYear()}<br>Érték: ${d.Price.toFixed(4)}`
                        );

                        plotData.push({
                            type: 'violin',
                            y: yValues,
                            x: Array(yValues.length).fill(countryMap[country]),
                            name: countryMap[country],
                            box: { visible: true },
                            meanline: { visible: true },
                            points: 'all',
                            pointpos: 0,
                            marker: { color: colors[country] },
                            text: hoverTexts,
                            hoverinfo: 'text',
                            hovertemplate: `<b>%{x}</b><br>Év: %{y}<br>Érték: %{text}<extra></extra>`
                        });
                    }
                });

                const layout = {
                    title: {
                        text: 'Gyermekhalálozási Arány alakulása Nyugat és Kelet Európában, 1990 és 2017 között',
                        font: {
                            size: 24,
                            family: 'Arial, sans-serif',
                            weight: 'bold'
                        },
                        x: 0.5,
                        xanchor: 'center'
                    },
                    xaxis: {
                        title: {
                            text: 'Ország',
                            font: {
                                size: 18,
                                family: 'Arial, sans-serif',
                                weight: 'bold'
                            }
                        },
                        tickangle: -30,
                        showgrid: true
                    },
                    yaxis: {
                        title: {
                            text: 'Gyermekhalálozási Arány',
                            font: {
                                size: 18,
                                family: 'Arial, sans-serif',
                                weight: 'bold'
                            }
                        },
                        showgrid: true
                    },
                    paper_bgcolor: 'rgba(0,0,0,0)',
                    plot_bgcolor: 'rgba(0,0,0,0)',
                    showlegend: true
                };

                const config = {
                    displaylogo: false,
                    modeBarButtonsToRemove: ['zoom2d', 'pan2d', 'select2d', 'lasso2d']
                };

                Plotly.newPlot('violin-plot-child', plotData, layout, config);
            });

        // Life Expectancy Visualization
        // Set up chart dimensions
        window.addEventListener('DOMContentLoaded', function() {
            const margin = {top: 40, right: 10, bottom: 120, left: 40};
            const width = 1100 - margin.left - margin.right;
            const height = 700 - margin.top - margin.bottom;

            // Create SVG
            const svg = d3.select("#chart")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            // Create tooltip
            const tooltip = d3.select("body")
                .append("div")
                .attr("class", "tooltip")
                .style("opacity", 0);

            // Create scales
            const x = d3.scaleBand()
                .range([20, width - 20])
                .padding(0.25);

            const y = d3.scaleLinear()
                .range([height, 0]);

            // Create axes groups
            const xAxis = svg.append("g")
                .attr("transform", `translate(0,${height})`);

            const yAxis = svg.append("g");

            // Function to fetch and process data
            async function fetchData() {
                try {
                    const response = await fetch('https://raw.githubusercontent.com/FHuni/FHuni.github.io/refs/heads/main/Projekt/life_expectancy_viz.json');
                    const data = await response.json();
                    
                    // Get unique years and sort them
                    const years = [...new Set(data.map(d => d.year))].sort((a, b) => a - b);
                    
                    // A kiválasztott országok
                    const selectedCountries = ["Switzerland", "France", "Sweden", "Austria", "Norway", "Poland", "Hungary", "Bulgaria", "Romania"];
                    
                    // Populate year dropdown
                    const yearSelect = document.getElementById("yearSelect");
                    years.forEach(year => {
                        const option = document.createElement("option");
                        option.value = year;
                        option.textContent = year;
                        // Select 2020 by default
                        if (year === 2020) {
                            option.selected = true;
                        }
                        yearSelect.appendChild(option);
                    });
                    
                    // Megváltoztatjuk a countryCount dropdown-t is
                    const countryCount = document.getElementById("countryCount");
                    countryCount.innerHTML = ""; // Töröljük a régi opciókat
                    
                    const option1 = document.createElement("option");
                    option1.value = "selected";
                    option1.textContent = "Selected Countries";
                    option1.selected = true;
                    countryCount.appendChild(option1);
                    
                    const option2 = document.createElement("option");
                    option2.value = "10";
                    option2.textContent = "Top 10 Countries";
                    countryCount.appendChild(option2);
                    
                    const option3 = document.createElement("option");
                    option3.value = "20";
                    option3.textContent = "Top 20 Countries";
                    countryCount.appendChild(option3);
                    
                    const option4 = document.createElement("option");
                    option4.value = "50";
                    option4.textContent = "Top 50 Countries";
                    countryCount.appendChild(option4);
                    
                    // Initialize chart with latest year and selected countries
                    updateChart(data, 2020, "selected", selectedCountries);
                    
                    // Add event listeners for dropdowns
                    yearSelect.addEventListener("change", () => {
                        const selectedYear = parseInt(yearSelect.value);
                        const selectedOption = countryCount.value;
                        updateChart(data, selectedYear, selectedOption, selectedCountries);
                    });
                    
                    countryCount.addEventListener("change", () => {
                        const selectedYear = parseInt(yearSelect.value);
                        const selectedOption = countryCount.value;
                        updateChart(data, selectedYear, selectedOption, selectedCountries);
                    });
                    
                } catch (error) {
                    console.error("Error loading data:", error);
                    document.getElementById("chart").innerHTML = 
                        `<p style="color: red; text-align: center;">Error loading data. Please try again later.</p>`;
                }
            }

            // Function to update chart based on selected year and country count
            function updateChart(data, year, countryOption, selectedCountries) {
                let filteredData;
                
                // Adatok szűrése az év alapján
                if (countryOption === "selected") {
                    // Csak a kiválasztott országokat jelenítjük meg
                    filteredData = data
                        .filter(d => d.year === year && selectedCountries.includes(d.country))
                        .sort((a, b) => selectedCountries.indexOf(a.country) - selectedCountries.indexOf(b.country));
                } else {
                    // Top N országot jelenítünk meg
                    const topCount = parseInt(countryOption);
                    filteredData = data
                        .filter(d => d.year === year)
                        .sort((a, b) => b.value - a.value)
                        .slice(0, topCount);
                }
                
                // Töröljük a #chart tartalmát, hogy ne legyen duplikált SVG
                d3.select("#chart").selectAll("*").remove();

                // Újra létrehozzuk az SVG-t és a csoportokat
                const svg = d3.select("#chart")
                    .append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform", `translate(${margin.left},${margin.top})`);

                // Skálák
                x.domain(filteredData.map(d => d.country));
                y.domain([0, 90]); // y-tengely 0-tól 90-ig

                // Tengelyek
                const xAxis = svg.append("g")
                    .attr("transform", `translate(0,${height})`)
                    .call(d3.axisBottom(x))
                    .selectAll("text")
                    .style("text-anchor", "end")
                    .attr("dx", "-.8em")
                    .attr("dy", ".15em")
                    .attr("transform", "rotate(-45)")
                    .style("font-size", "10px");

                svg.append("g")
                    .call(d3.axisLeft(y));

                // Oszlopok
                svg.selectAll(".bar")
                    .data(filteredData, d => d.country)
                    .enter()
                    .append("rect")
                    .attr("class", "bar")
                    .attr("x", d => x(d.country))
                    .attr("width", x.bandwidth())
                    .attr("y", d => y(d.value))
                    .attr("height", d => height - y(d.value))
                    .on("mouseover", function(event, d) {
                        tooltip.transition()
                            .duration(200)
                            .style("opacity", .9);
                        tooltip.html(`<strong>${d.country}</strong><br>Life Expectancy: ${d.value.toFixed(2)} years`)
                            .style("left", (event.pageX + 10) + "px")
                            .style("top", (event.pageY - 28) + "px");
                        d3.select(this).style("fill", "#ff7f0e");
                    })
                    .on("mouseout", function() {
                        tooltip.transition()
                            .duration(500)
                            .style("opacity", 0);
                        d3.select(this).style("fill", "steelblue");
                    });

                // Cím frissítése
                document.getElementById("lifeexp-title").textContent = `Life Expectancy by Country (${year})`;
            }

            // Initialize the chart
            fetchData();
        });

        // Air Pollution Visualization
        const margin = {top: 40, right: 10, bottom: 120, left: 40};
        const width = 1100 - margin.left - margin.right;
        const height = 700 - margin.top - margin.bottom;

        // Create SVG
        const svg = d3.select("#chart")
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", `translate(${margin.left},${margin.top})`);

        // Create tooltip
        const tooltip = d3.select("body")
            .append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);

        // Create scales
        const x = d3.scaleBand()
            .range([20, width - 20])
            .padding(0.25);

        const y = d3.scaleLinear()
            .range([height, 0]);

        // Create axes groups
        const xAxis = svg.append("g")
            .attr("transform", `translate(0,${height})`);

        const yAxis = svg.append("g");

        // Function to fetch and process data
        async function fetchData() {
            try {
                const response = await fetch('https://raw.githubusercontent.com/FHuni/FHuni.github.io/refs/heads/main/Projekt/life_expectancy_viz.json');
                const data = await response.json();
                
                // Get unique years and sort them
                const years = [...new Set(data.map(d => d.year))].sort((a, b) => a - b);
                
                // A kiválasztott országok
                const selectedCountries = ["Switzerland", "France", "Sweden", "Austria", "Norway", "Poland", "Hungary", "Bulgaria", "Romania"];
                
                // Populate year dropdown
                const yearSelect = document.getElementById("yearSelect");
                years.forEach(year => {
                    const option = document.createElement("option");
                    option.value = year;
                    option.textContent = year;
                    // Select 2020 by default
                    if (year === 2020) {
                        option.selected = true;
                    }
                    yearSelect.appendChild(option);
                });
                
                // Megváltoztatjuk a countryCount dropdown-t is
                const countryCount = document.getElementById("countryCount");
                countryCount.innerHTML = ""; // Töröljük a régi opciókat
                
                const option1 = document.createElement("option");
                option1.value = "selected";
                option1.textContent = "Selected Countries";
                option1.selected = true;
                countryCount.appendChild(option1);
                
                const option2 = document.createElement("option");
                option2.value = "10";
                option2.textContent = "Top 10 Countries";
                countryCount.appendChild(option2);
                
                const option3 = document.createElement("option");
                option3.value = "20";
                option3.textContent = "Top 20 Countries";
                countryCount.appendChild(option3);
                
                const option4 = document.createElement("option");
                option4.value = "50";
                option4.textContent = "Top 50 Countries";
                countryCount.appendChild(option4);
                
                // Initialize chart with latest year and selected countries
                updateChart(data, 2020, "selected", selectedCountries);
                
                // Add event listeners for dropdowns
                yearSelect.addEventListener("change", () => {
                    const selectedYear = parseInt(yearSelect.value);
                    const selectedOption = countryCount.value;
                    updateChart(data, selectedYear, selectedOption, selectedCountries);
                });
                
                countryCount.addEventListener("change", () => {
                    const selectedYear = parseInt(yearSelect.value);
                    const selectedOption = countryCount.value;
                    updateChart(data, selectedYear, selectedOption, selectedCountries);
                });
                
            } catch (error) {
                console.error("Error loading data:", error);
                document.getElementById("chart").innerHTML = 
                    `<p style="color: red; text-align: center;">Error loading data. Please try again later.</p>`;
            }
        }

        // Function to update chart based on selected year and country count
        function updateChart(data, year, countryOption, selectedCountries) {
            let filteredData;
            
            // Adatok szűrése az év alapján
            if (countryOption === "selected") {
                // Csak a kiválasztott országokat jelenítjük meg
                filteredData = data
                    .filter(d => d.year === year && selectedCountries.includes(d.country))
                    .sort((a, b) => selectedCountries.indexOf(a.country) - selectedCountries.indexOf(b.country));
            } else {
                // Top N országot jelenítünk meg
                const topCount = parseInt(countryOption);
                filteredData = data
                    .filter(d => d.year === year)
                    .sort((a, b) => b.value - a.value)
                    .slice(0, topCount);
            }
            
            // Töröljük a #chart tartalmát, hogy ne legyen duplikált SVG
            d3.select("#chart").selectAll("*").remove();

            // Újra létrehozzuk az SVG-t és a csoportokat
            const svg = d3.select("#chart")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            // Skálák
            x.domain(filteredData.map(d => d.country));
            y.domain([0, 90]); // y-tengely 0-tól 90-ig

            // Tengelyek
            const xAxis = svg.append("g")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(x))
                .selectAll("text")
                .style("text-anchor", "end")
                .attr("dx", "-.8em")
                .attr("dy", ".15em")
                .attr("transform", "rotate(-45)")
                .style("font-size", "10px");

            svg.append("g")
                .call(d3.axisLeft(y));

            // Oszlopok
            svg.selectAll(".bar")
                .data(filteredData, d => d.country)
                .enter()
                .append("rect")
                .attr("class", "bar")
                .attr("x", d => x(d.country))
                .attr("width", x.bandwidth())
                .attr("y", d => y(d.value))
                .attr("height", d => height - y(d.value))
                .on("mouseover", function(event, d) {
                    tooltip.transition()
                        .duration(200)
                        .style("opacity", .9);
                    tooltip.html(`<strong>${d.country}</strong><br>Life Expectancy: ${d.value.toFixed(2)} years`)
                        .style("left", (event.pageX + 10) + "px")
                        .style("top", (event.pageY - 28) + "px");
                    d3.select(this).style("fill", "#ff7f0e");
                })
                .on("mouseout", function() {
                    tooltip.transition()
                        .duration(500)
                        .style("opacity", 0);
                    d3.select(this).style("fill", "steelblue");
                });

            // Cím frissítése
            document.getElementById("lifeexp-title").textContent = `Life Expectancy by Country (${year})`;
        }

        // Initialize the chart
        fetchData();

        // Air Pollution Visualization
        fetch("https://raw.githubusercontent.com/FHuni/FHuni.github.io/refs/heads/main/Projekt/air_pollution_final.json")
            .then(response => response.json())
            .then(data => {
                const countryData = {};
                data.forEach(entry => {
                    const country = entry.Country;
                    const value = entry.Price;
                    const year = new Date(entry.Date).getFullYear();
                    if (!countryData[country]) countryData[country] = {};
                    if (!countryData[country][year]) countryData[country][year] = [];
                    countryData[country][year].push(value);
                });

                const countryMap = {
                    "Switzerland": "Svájc",
                    "France": "Franciaország",
                    "Sweden": "Svédország",
                    "Austria": "Ausztria",
                    "Norway": "Norvégia",
                    "Poland": "Lengyelország",
                    "Hungary": "Magyarország",
                    "Bulgaria": "Bulgária",
                    "Romania": "Románia"
                };

                const selectedCountries = ["Switzerland", "France", "Sweden", "Austria", "Norway", "Poland", "Bulgaria", "Hungary", "Romania"];
                const plotData = [];
                const percentageChanges = {};

                selectedCountries.forEach(country => {
                    if (countryData[country]) {
                        const years = Object.keys(countryData[country]).sort();
                        const values = years.map(year =>
                            countryData[country][year].reduce((a, b) => a + b, 0) / countryData[country][year].length
                        );

                        const change = ((values[values.length - 1] - values[0]) / values[0]) * 100;
                        percentageChanges[country] = change.toFixed(2) + '%';

                        plotData.push({
                            x: years,
                            y: values,
                            mode: 'lines+markers',
                            name: countryMap[country],
                            hoverinfo: 'text',
                            hovertext: years.map((year, index) =>
                                `Ország: ${countryMap[country]}<br>Év: ${year}<br>Légszennyezés: ${values[index].toFixed(2)}<br>Változás: ${percentageChanges[country]}`)
                        });
                    }
                });

                const layout = {
                    xaxis: {
                        title: {
                            text: 'Évek',
                            font: { size: 14 }
                        },
                        tickvals: [1990, 1993, 1996, 1999, 2002, 2005, 2008, 2011, 2014, 2017],
                        ticktext: ['1990', '1993', '1996', '1999', '2002', '2005', '2008', '2011', '2014', '2017'],
                        showgrid: true,
                        gridcolor: 'rgba(180, 180, 180, 0.6)'
                    },
                    yaxis: {
                        title: {
                            text: 'Légszennyezés (PM2.5)',
                            font: { size: 14 }
                        },
                        showgrid: true,
                        gridcolor: 'rgba(180, 180, 180, 0.6)'
                    },
                    margin: { t: 50, l: 80, r: 30, b: 80 },
                    showlegend: true,
                    legend: {
                        title: {
                            text: "Országok",
                            font: { 
                                size: 18,
                                family: 'Arial, sans-serif',
                                weight: 'bold'
                            }
                        },
                        font: { size: 16 },
                        bgcolor: "rgba(255, 255, 255, 0.8)",
                        bordercolor: "lightgray",
                        borderwidth: 1,
                        borderradius: 20,
                        orientation: "v",
                        x: 1.1,
                        y: 1,
                        xanchor: "left",
                        padding: 15
                    },
                    paper_bgcolor: 'rgba(0, 0, 0, 0)',
                    plot_bgcolor: 'rgba(0, 0, 0, 0)'
                };

                Plotly.newPlot('line-chart-air', plotData, layout);
            });

        // Map Visualization
        var map = L.map('map').setView([50, 15], 4);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '© OpenStreetMap'
        }).addTo(map);

        // Országok koordinátái
        const countryCoordinates = {
            "Switzerland": [46.948, 7.4474],
            "France": [48.8566, 2.3522],
            "Sweden": [59.3293, 18.0686],
            "Austria": [47.5162, 14.5501],
            "Norway": [59.9139, 10.7522],
            "Poland": [52.2297, 21.0122],
            "Hungary": [47.4979, 19.0402],
            "Bulgaria": [42.7339, 25.4858],
            "Romania": [44.4268, 26.1025]
        };

        // Színkódok az inflációs értékekhez
        function getColor(inflation) {
            return inflation > 200 ? '#800026' :
                   inflation > 100 ? '#BD0026' :
                   inflation > 50  ? '#E31A1C' :
                   inflation > 20  ? '#FC4E2A' :
                   inflation > 10  ? '#FD8D3C' :
                   inflation > 5   ? '#FEB24C' :
                   inflation > 0   ? '#FFEDA0' :
                                    '#FFFFFF';
        }

        // Adatok betöltése
        fetch('https://raw.githubusercontent.com/FHuni/FHuni.github.io/refs/heads/main/Projekt/global_inflation_data_final.json')
            .then(response => response.json())
            .then(data => {
                const countryMapAll = {
                    "Switzerland": "Svájc",
                    "France": "Franciaország",
                    "Sweden": "Svédország",
                    "Austria": "Ausztria",
                    "Norway": "Norvégia",
                    "Poland": "Lengyelország",
                    "Hungary": "Magyarország",
                    "Bulgaria": "Bulgária",
                    "Romania": "Románia"
                };

                data.forEach(function(item) {
                    if (countryCoordinates[item.Country]) {
                        const coords = countryCoordinates[item.Country];
                        const circle = L.circle(coords, {
                            color: getColor(item.Price),
                            fillColor: getColor(item.Price),
                            fillOpacity: 0.5,
                            radius: 100000
                        }).addTo(map);

                        circle.bindPopup(`
                            <b>${countryMapAll[item.Country] || item.Country}</b><br>
                            Infláció: ${item.Price.toFixed(2)}%<br>
                            Dátum: ${item["String Date"]}
                        `);
                    }
                });
            })
            .catch(error => console.error('Hiba történt az adatok betöltésekor:', error));
    </script>
</body>
</html> 